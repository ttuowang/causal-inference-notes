<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 3 Sensitivity Analysis I | Causal Inference</title>
  <meta name="description" content="This is the notes of Causal Inference. Most of the materials come from STAT 992 instructed by Prof. Kang and from several textbooks in causal inference" />
  <meta name="generator" content="bookdown 0.21 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 3 Sensitivity Analysis I | Causal Inference" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="This is the notes of Causal Inference. Most of the materials come from STAT 992 instructed by Prof. Kang and from several textbooks in causal inference" />
  <meta name="github-repo" content="ttuowang/causal-inference-notes" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 3 Sensitivity Analysis I | Causal Inference" />
  
  <meta name="twitter:description" content="This is the notes of Causal Inference. Most of the materials come from STAT 992 instructed by Prof. Kang and from several textbooks in causal inference" />
  

<meta name="author" content="Tuo Wang" />


<meta name="date" content="2020-10-18" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="matching.html"/>
<link rel="next" href="models.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script>



<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Causal Inference</a></li>

<li class="divider"></li>
<li class="part"><span><b>I Introduction</b></span></li>
<li class="chapter" data-level="1" data-path="basic.html"><a href="basic.html"><i class="fa fa-check"></i><b>1</b> Propensity score</a></li>
<li class="chapter" data-level="2" data-path="matching.html"><a href="matching.html"><i class="fa fa-check"></i><b>2</b> Matching</a><ul>
<li class="chapter" data-level="2.1" data-path="matching.html"><a href="matching.html#what-is-matching"><i class="fa fa-check"></i><b>2.1</b> What is matching?</a></li>
<li class="chapter" data-level="2.2" data-path="matching.html"><a href="matching.html#exact-matching"><i class="fa fa-check"></i><b>2.2</b> Exact Matching</a></li>
<li class="chapter" data-level="2.3" data-path="matching.html"><a href="matching.html#propensity-score-matching"><i class="fa fa-check"></i><b>2.3</b> Propensity Score Matching</a></li>
<li class="chapter" data-level="2.4" data-path="matching.html"><a href="matching.html#multivariate-caliper-matching"><i class="fa fa-check"></i><b>2.4</b> Multivariate Caliper Matching</a><ul>
<li class="chapter" data-level="2.4.1" data-path="matching.html"><a href="matching.html#a-mahalanobis-distances"><i class="fa fa-check"></i><b>2.4.1</b> (a) Mahalanobis Distances</a></li>
<li class="chapter" data-level="2.4.2" data-path="matching.html"><a href="matching.html#b-penalize-large-distance"><i class="fa fa-check"></i><b>2.4.2</b> (b) Penalize large distance</a></li>
</ul></li>
<li class="chapter" data-level="2.5" data-path="matching.html"><a href="matching.html#matching-with-multiple-controls"><i class="fa fa-check"></i><b>2.5</b> Matching with Multiple controls</a></li>
<li class="chapter" data-level="2.6" data-path="matching.html"><a href="matching.html#full-matching"><i class="fa fa-check"></i><b>2.6</b> Full Matching</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="sensitivity1.html"><a href="sensitivity1.html"><i class="fa fa-check"></i><b>3</b> Sensitivity Analysis I</a><ul>
<li class="chapter" data-level="3.1" data-path="sensitivity1.html"><a href="sensitivity1.html#sensitivity-analysis-for-matched-sets-with-binary-outcomes"><i class="fa fa-check"></i><b>3.1</b> Sensitivity Analysis for Matched Sets with Binary Outcomes</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="models.html"><a href="models.html"><i class="fa fa-check"></i><b>4</b> causal Inference with Models</a><ul>
<li class="chapter" data-level="4.1" data-path="models.html"><a href="models.html#ipw-estimator"><i class="fa fa-check"></i><b>4.1</b> IPW estimator</a></li>
<li class="chapter" data-level="4.2" data-path="models.html"><a href="models.html#outcome-regression"><i class="fa fa-check"></i><b>4.2</b> Outcome Regression</a></li>
<li class="chapter" data-level="4.3" data-path="models.html"><a href="models.html#doubly-robust-estimator"><i class="fa fa-check"></i><b>4.3</b> Doubly robust estimator</a></li>
<li class="chapter" data-level="4.4" data-path="models.html"><a href="models.html#asymptotic-variance"><i class="fa fa-check"></i><b>4.4</b> Asymptotic variance</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="sensitivity2.html"><a href="sensitivity2.html"><i class="fa fa-check"></i><b>5</b> Sensitivity Analysis II</a><ul>
<li class="chapter" data-level="5.1" data-path="sensitivity2.html"><a href="sensitivity2.html#e-value"><i class="fa fa-check"></i><b>5.1</b> E-value</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="iv.html"><a href="iv.html"><i class="fa fa-check"></i><b>6</b> Instrumental Variable</a><ul>
<li class="chapter" data-level="6.1" data-path="iv.html"><a href="iv.html#iv-without-covariates-x"><i class="fa fa-check"></i><b>6.1</b> IV without covariates X</a></li>
<li class="chapter" data-level="6.2" data-path="iv.html"><a href="iv.html#iv-with-covariates-x"><i class="fa fa-check"></i><b>6.2</b> IV with covariates X</a></li>
<li class="chapter" data-level="6.3" data-path="iv.html"><a href="iv.html#new-topics-in-i.v."><i class="fa fa-check"></i><b>6.3</b> New topics in I.V.</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="m-estimator.html"><a href="m-estimator.html"><i class="fa fa-check"></i><b>7</b> notes on M-estimator</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Causal Inference</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="sensitivity1" class="section level1">
<h1><span class="header-section-number">Chapter 3</span> Sensitivity Analysis I</h1>
<p>This chapter will cover the following topics:</p>
<p>Sensitivity analysis is designed to answer what does an unmeasurable variable do in terms of impacting our causal condlusions about A and Y.</p>
<div id="sensitivity-analysis-for-matched-sets-with-binary-outcomes" class="section level2">
<h2><span class="header-section-number">3.1</span> Sensitivity Analysis for Matched Sets with Binary Outcomes</h2>
<table>
<thead>
<tr class="header">
<th>Matched set id</th>
<th>subject</th>
<th>covariate</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Matched set 1</td>
<td>Bob-Scott</td>
<td><span class="math inline">\(X_{Bob} \approx X_{Scott}\)</span></td>
</tr>
<tr class="even">
<td>Matched set 2</td>
<td>Jenn-Kathleen</td>
<td><span class="math inline">\(X_{Jenn} \approx X_{Kathleen}\)</span></td>
</tr>
<tr class="odd">
<td><span class="math inline">\(\vdots\)</span></td>
<td><span class="math inline">\(\vdots\)</span></td>
<td><span class="math inline">\(\vdots\)</span></td>
</tr>
<tr class="even">
<td>Matched set I</td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<p>By ignorability assumption, <span class="math inline">\(Y_{i}(1), Y_{i}(0), X_{i} \perp A_{i}\)</span>, either one of the pair is equally likely to get treatment. Formally:
<span class="math display">\[\begin{align*}
p_1 &amp;= \text{Prob that Bob Smokes and Scott doesn&#39;t} \\
1 - p_1 &amp;= \text{Prob that Scott Smokes and Bob doesn&#39;t}
\end{align*}\]</span>
Under assumption: <span class="math inline">\(p_1 = \frac{1}{2}\)</span>. More generally, <span class="math inline">\(p_s = \frac{1}{2}, \forall s=1,\cdots,I\)</span>. Suppose Bob is more like to smoke than Scott because he carries gene and <span class="math inline">\(p_1\)</span> could range between certain values, say:</p>
<p><span class="math display">\[\frac{1}{1+\Gamma} \leq p_1 \leq \frac{\Gamma}{1+\Gamma}, \,\, \Gamma \geq 1\]</span>
For example, <span class="math inline">\(\Gamma=1 \implies p_1 =\frac{1}{2}\)</span>, <span class="math inline">\(\Gamma=3 \implies 0.25 \leq p_1 \leq 0.75\)</span>.</p>
<p><span class="math inline">\(\Gamma\)</span> is the sensitivity parameters. <span class="math inline">\(\Gamma = 1 \implies\)</span> random experiment given <span class="math inline">\(X\)</span>. <span class="math inline">\(\Gamma &gt; 1 \implies\)</span> non-random experiment of A due to uncertain variable U.</p>
<p>Rewrite we can get,</p>
<p><span class="math display">\[\frac{1}{\Gamma} \leq \frac{p_1}{1-p_1} \leq \Gamma,\]</span>
where <span class="math inline">\(\frac{p_1}{1-p_1}\)</span> is the odds ratio of Bob smoking versus Scott smoking.</p>
<p>Conside <span class="math inline">\(H_0: Y_i{(1)} = Y_i{(0)}\,\,\forall i\)</span></p>
<p><span class="math display">\[\hat{ATE} = \frac{1}{I} \sum_{s=1}^{I} \delta_s,\]</span></p>
<p>where <span class="math inline">\(\delta_s\)</span> is the difference in outcome between treated and control in matched set <span class="math inline">\(s\)</span>. We can use <span class="math inline">\(\hat{ATE}\)</span> to test <span class="math inline">\(H_0\)</span>. For simplicity, <span class="math inline">\(T= \frac{1}{I} \sum_{s=1}^{I} \delta_s\)</span>. Under <span class="math inline">\(H_0\)</span>:</p>
<p><span class="math display">\[\begin{align*}
Y_{Bob}(1) &amp;=  Y_{Bob}(0)\\
Y_{Scott}(1) &amp;= Y_{Scott}(0)
\end{align*}\]</span></p>
<p>Thus,
<span class="math display">\[\begin{align*}
\delta_1 &amp;= 
\begin{cases}
    Y_{Bob}(1) - Y_{Scott}(0),&amp; p_1\\
    Y_{Scott}(1) - Y_{Bob}(0),&amp; 1 - p_1
\end{cases} \\
&amp;= 
\begin{cases}
    Y_{Bob}(0) - Y_{Scott}(0),&amp; p_1\\
    Y_{Scott}(0) - Y_{Bob}(0),&amp; 1 - p_1
\end{cases}
\end{align*}\]</span>
<span class="math inline">\(\delta_1\)</span> only changes in sign denpending on who gets treated. Thus,</p>
<p><span class="math display">\[\delta_1 = Q_1 \times |Y_{Bob}(0) - Y_{Scott}(0)|,\]</span>
where <span class="math inline">\(Q_1 = \begin{cases}  1,&amp; p_1\\  -1,&amp; 1 - p_1 \end{cases}\)</span></p>
<p>Thus under <span class="math inline">\(H_0\)</span>,</p>
<p><span class="math display">\[T = \sum_{s=1}^{I} \delta_s = \sum_{s=1}^{I}Q_sC_s = \sum_{s:C_s\neq0}Q_s,\]</span>
where <span class="math inline">\(Q_s = \begin{cases}  1,&amp; p_1\\  -1,&amp; 1 - p_1 \end{cases}\)</span> and <span class="math inline">\(C_s = 1\)</span> or <span class="math inline">\(0\)</span> in binary outcome</p>
<p>We can add a term transform the term in the summation. That is <span class="math inline">\(Q_s = -1\)</span> or <span class="math inline">\(1\)</span>, we can do a easy linear transformation to let term equal <span class="math inline">\(0\)</span> and <span class="math inline">\(1\)</span>.</p>
<p>Let <span class="math inline">\(d = \sum_{s=1}^{I} \mathbb{I}(C_s \neq 0)\)</span>. Then,
<span class="math display">\[\frac{T+d}{2} = \sum_{s:C_s\neq0}\frac{Q_s+1}{2} \sim Bin(d, \frac{1}{2})\]</span>
<span class="math inline">\(\frac{T+d}{2}\)</span> follows a binomial distribuiton with <span class="math inline">\(n=d\)</span> and <span class="math inline">\(p=\frac{1}{2}\)</span>.Thus the p-value = <span class="math inline">\(\mathbb{P}(Bin(d,\frac{1}{2}) &gt; \frac{T_{obs} + d}{2})\)</span>(Note that d is a constant once given observations).</p>
<p>Now suupose <span class="math inline">\(p_1 \neq \frac{1}{2}\)</span> e.g. <span class="math inline">\(p_1 &gt; \frac{1}{2}\)</span> (Bob is more likely to smoke than scott). Instead we can assume <span class="math inline">\(p_1\)</span> is in a certain range i.e. <span class="math inline">\(\frac{1}{1+\Gamma} \leq p_1 \leq \frac{\Gamma}{1+\Gamma}\)</span>.</p>
<p><strong>What is the new p-value if <span class="math inline">\(\Gamma &gt; 1\)</span>?</strong> We may not be able to find the exact p-value but we can find the range of the p-value, i.e. we can find the upper and lower bound of the p-value.</p>
<p><span class="math display">\[\mathbb{P}(Bin(d, \frac{1}{1+\Gamma}) &gt; \frac{T_{obs}+d}{2}) \leq \mathbb{P}(\frac{T+d}{2} &gt; \frac{T_{obs}+d}{2}) \leq \mathbb{P}(Bin(d, \frac{\Gamma}{1+\Gamma}) &gt; \frac{T_{obs}+d}{2})\]</span></p>
<p><strong>How to choose the value of <span class="math inline">\(\Gamma\)</span>:</strong></p>
<ul>
<li><ol style="list-style-type: decimal">
<li>Compute the range of p-values for each <span class="math inline">\(\Gamma\)</span>, e.g <span class="math inline">\(\Gamma = 1,2,\cdots\)</span></li>
</ol></li>
<li><ol start="2" style="list-style-type: decimal">
<li>Stop if the range of p-value contains <span class="math inline">\(\alpha = 0.05\)</span></li>
</ol></li>
</ul>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="matching.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="models.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/rstudio/bookdown-demo/edit/master/03-sensitivity-analysis.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["causual-inference-notes.pdf", "causual-inference-notes.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
